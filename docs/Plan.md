# План автоматизации тестирования сервиса покупки туров через интернет-банк

## 1. Перечень автоматизируемых сценариев

## UI-тесты

### Cценарии Happy Path:

#### Happy Path 1: Покупка тура через кнопку "Купить" с главной страницы сервиса.
<em>Cценарий 1.1: Оплата с помощью валидной карты, на которой есть достаточное количество денежных средств. Операция должна быть одобрена.</em>

![изображение](https://user-images.githubusercontent.com/93249349/235319378-f494d427-b09a-43ae-ae8a-484a1480c463.png)

**Шаги по воспроизведению:**
1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем форму заявки полностью валидными данными карты, на которой достаточно ДС: "Номер" = "4444 4444 4444 4441", "Месяц" = "08", 
"Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123";
3. Нажимаем на кнопку "Продолжить";
4. Ожидаем результат после отправки запроса в банк.

<em>Ожидаемый результат: появляется уведомление "Успешно. Операция одобрена Банком".</em>

<em>Cценарий 1.2: Оплата с валидной карты, на которой недостаточное количество денежных средств. Отказ в проведении операции.</em>

**Шаги по воспроизведению:**
1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем форму заявки полностью валидными данными карты, на которой недостаточно ДС: "Номер" = "4444 4444 4444 4442", "Месяц" = "08", 
"Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123";
3. Нажимаем на кнопку "Продолжить";
4. Ожидаем результат после отправки запроса в банк.

<em>Ожидаемый результат: появляется уведомление об ошибке "Ошибка! Банк отказал в проведении операции".</em>

#### Happy Path 2: Покупка тура через кнопку "Купить в кредит" с главной страницы сервиса.
<em>Cценарий 2.1: Оплата в кредит с помощью валидной карты, с достаточным кредитным лимитом. Операция должна быть одобрена.</em>

![изображение](https://user-images.githubusercontent.com/93249349/235319454-f0b8f364-9427-4ba9-92e1-8b44f6d18f9c.png)

**Шаги по воспроизведению:**
1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем форму заявки полностью валидными данными карты, на которой не исчерпан кредитный лимит: "Номер" = "4444 4444 4444 4441", "Месяц" = "08", 
"Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123";
3. Нажимаем на кнопку "Продолжить";
4. Ожидаем результат после отправки запроса в банк.

<em>Ожидаемый результат: появляется уведомление "Успешно. Операция одобрена Банком".</em>

<em>Cценарий 2.2: Оплата в кредит с помощью валидной карты, с недостаточным кредитным лимитом. Отказ в проведении операции.</em>

**Шаги по воспроизведению:**
1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем форму заявки полностью валидными данными карты, на которой исчерпан кредитный лимит: "Номер" = "4444 4444 4444 4442", "Месяц" = "08", 
"Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123";
3. Нажимаем на кнопку "Продолжить";
4. Ожидаем результат после отправки запроса в банк.

<em>Ожидаемый результат: появляется уведомление об ошибке "Ошибка! Банк отказал в проведении операции".</em>

------------

### Тестирование полей форм ввода данных

Каждый тестовый сценарий для тестирования формы ввода подразумевает стандартный путь захода на страницу формы 
(в зависимости от того, какую именно форму мы хотим протестировать):

- Для формы "Оплата по карте": на главной странице сервиса нажимаем на кнопку "Купить";
- Для формы "Кредит по данным карты": на главной странице сервиса нажимаем на кнопку "Купить в кредит";

После заполнения полей кликаем на кнопку "Продолжить" и ожидаем результат.
Так как позитивные сценарии покрываются сценариями Happy Path, то здесь и далее я буду писать только негативные, чтобы не дублировать

**Поле "Номер карты"**

Здесь и далее я буду писать одинаковые кейсы для форм, отличаться будут лишь пути захода.
Некоторые допущения по требованиям: поле принимает на вход только цифры, максимальное количество цифр — 16 (предположим, что здесь и далее я уточняю требования у руководства).

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Месяц" = "08", "Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Месяц" = "08", "Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123".

<em>Негативные сценарии:</em> 

1. Заявка не должна отправляться, если поле "Номер карты" пустое -- должен выводиться хинт "Поле обязательно для заполнения";
2. Заявка не должна отправляться, если поле "Номер карты" содержит 15 цифр (например, "4444 4444 4444 444") -- должен выводиться хинт "Неверный формат";
3. Заявка не должна отправляться, если поле "Номер карты" содержит номер карты другого банка, которого нет в БД (например, "5559 4444 4444 4444") -- должно выводиться сообщение "Ошибка! Банк отказал в проведении операции.".

**Поле "Месяц"**

Требования: данное поле принимает на вход номер месяца от 1 до 12, причем числам от 1 до 9 всегда предшествует 0, т.к. форма принимает только 2 числа.

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123".

<em>Негативные сценарии:</em>

1. Заявка не должна отправляться, если поле "Месяц" пустое -- должен выводиться хинт "Поле обязательно для заполнения";
2. Заявка не должна отправляться, если поле "Месяц" содержит нерелевантное значение (например, "00") -- должен выводиться хинт "Неверно указан срок действия карты";
3. Заявка не должна отправляться, если поле "Месяц" содержит любое двузначное число, которое больше 12 (например, "13") -- должен выводиться хинт "Неверно указан срок действия карты";
4. Заявка не должна отправляться, если поле "Месяц" содержит одну цифру (например, "1") -- должен выводиться хинт "Неверный формат".

**Поле "Год"**

Требования: данное поле принимает на вход номер года в формате двух последних цифр.

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Месяц" = "10", "Владелец" = "Ivan Ivanov", "CVV" = "123".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Месяц" = "10", "Владелец" = "Ivan Ivanov", "CVV" = "123".

<em>Негативные сценарии:</em>

1. Заявка не должна отправляться, если поле "Год" пустое -- должен выводиться хинт "Поле обязательно для заполнения";
2. Заявка не должна отправляться, если поле "Год" содержит цифры ранее текущего года (например, "22") -- должен выводиться хинт "Истёк срок действия карты";
3. Заявка не должна отправляться, если поле "Год" содержит цифры намного позже текущего года (например, "40") -- должен выводиться хинт "Неверно указан срок действия карты".

**Поле "Владелец"**

Требования: данное поле принимает на вход только фамилию и имя на латинском, первая буква в каждом из слов должна быть заглавной.

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "23", "Месяц" = "08", "CVV" = "123".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "23", "Месяц" = "08", "CVV" = "123".

<em>Негативные сценарии:</em>

1. Заявка не должна отправляться, если поле "Владелец" пустое -- должен выводиться хинт "Поле обязательно для заполнения";
2. Заявка не должна отправляться, если поле "Владелец" содержит одно слово на латинице (например, "Ivanov") -- должен выводиться хинт "Неверный формат";
3. Заявка не должна отправляться, если поле "Владелец" содержит три слова на латинице (например, "Ivan Ivanov Ivanovich") -- должен выводиться хинт "Неверный формат";
4. Заявка не должна отправляться, если поле "Владелец" содержит фамилию и имя в нижнем регистре (например, "ivan ivanov") -- должен выводиться хинт "Неверный формат";
5. Заявка не должна отправляться, если поле "Владелец" содержит фамилию и имя в верхнем регистре (например, "IVAN IVANOV") -- должен выводиться хинт "Неверный формат";
6. Заявка не должна отправляться, если поле "Владелец" содержит фамилию и имя на кириллице (например, "Иван Иванов") -- должен выводиться хинт "Неверный формат";
7. Заявка не должна отправляться, если поле "Владелец" содержит цифры (например, "12345") -- должен выводиться хинт "Неверный формат";
8. Заявка не должна отправляться, если поле "Владелец" содержит нерелевантные символы (например, "%№%№") -- должен выводиться хинт "Неверный формат".

**Поле "CVV"**

Требования: данное поле принимает на вход только 3 цифры.

<em>Предусловия для формы "Купить":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "23", "Месяц" = "08", "Владелец" = "Ivan Ivanov".

<em>Предусловия для формы "Купить в кредит":</em> 

1. На главной странице сервиса нажимаем на кнопку "Купить в кредит";
2. Заполняем поля следующими валидными данными: "Номер" = "4444 4444 4444 4441", "Год" = "23", "Месяц" = "08", "Владелец" = "Ivan Ivanov".

<em>Негативные сценарии:</em>

1. Заявка не должна отправляться, если поле "CVV" пустое -- должен выводиться хинт "Поле обязательно для заполнения";
2. Заявка не должна отправляться, если поле "CVV" содержит одну цифру (например, "1") -- должен выводиться хинт "Неверный формат";
3. Заявка не должна отправляться, если поле "CVV" содержит две цифры (например, "11") -- должен выводиться хинт "Неверный формат".

## API-тесты

Необходимо убедиться, что при попытке обратиться к приложению через API сервис отдает те же данные, что и при UI-тестах. Для этого будут необходимы 4 теста, которые проверяют разные карты и статус этих карт в БД при обращении напрямую к Payment Gate и Credit Gate.

<em>Предусловия для валидной карты со статусом APPROVED:</em> 

"Номер" = "4444 4444 4444 4441", "Месяц" = "08", "Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123".

<em>Предусловия для валидной карты со статусом DECLINED:</em> 

"Номер" = "4444 4444 4444 4442", "Месяц" = "08", "Год" = "23", "Владелец" = "Ivan Ivanov", "CVV" = "123".

**Тест-кейсы**
1. Удостоверяемся, что при обращении к URL-адресу http://localhost:8080/api/v1/pay мы получаем код ответа сервера 200 и банковская карта c номером "4444 4444 4444 4441" отдает статус APPROVED.
2. Удостоверяемся, что при обращении к URL-адресу http://localhost:8080/api/v1/pay мы получаем код ответа сервера 200 и банковская карта с номером "4444 4444 4444 4442" отдает статус DECLINED.
3. Удостоверяемся, что при обращении к URL-адресу http://localhost:8080/api/v1/credit мы получаем код ответа сервера 200 и банковская карта c номером "4444 4444 4444 4441" отдает статус APPROVED.
4. Удостоверяемся, что при обращении к URL-адресу http://localhost:8080/api/v1/credit мы получаем код ответа сервера 200 и банковская карта с номером "4444 4444 4444 4442" отдает статус DECLINED.

## 2. Перечень используемых инструментов

- **IntelliJ IDEA CE**

IDEA - это среда разработки с множеством функций, которая подходит как для новичков, так и для профессионалов. Она содержит в себе мощный редактор кода с множеством встроенных инструментов, поддержку интеграции с системами контроля версий, интеллектуальное автодополнение кода, возможность работы с различными языками программирования и многое другое.

- **Java 11**

Выбран язык программирования для написания проекта - Java. Статистика показывает, что Java является одним из самых популярных языков программирования в мире. Этот язык широко распространен и универсальный, с помощью него написано множество сайтов, приложений и программного обеспечения, включая программное обеспечение для умных домов, например.

- **Gradle**

В качестве системы сборки проекта будет использоваться Gradle, с возможностью использования Maven как альтернативного варианта. Выбор обусловлен рядом причин, включая скорость сборки, гибкость системы, производительность и UX. При сравнении файлов конфигурации, build.gradle предпочтительнее за счет своей простоты и минимума кода.

- **Git**

Для контроля версий нашего проекта мы будем использовать Git, так как это современная система контроля версий, которая позволяет откатываться к предыдущим версиям, вести параллельную разработку через систему ветвления и имеет интеграцию с IDEA.

- **JUnit-5**

Мы будем использовать тестовый фреймворк JUnit, так как это один из наиболее популярных тестовых фреймворков на сегодняшний день, который обладает всем необходимым функционалом и аннотациями.

- **Selenide**

Для тестирования веб-приложений на основе Selenium WebDriver мы будем использовать фреймворк Selenide, который предоставляет удобный веб-драйвер "из коробки" и позволяет сократить время написания тестов и количество строк кода.

- **Lombok**

Мы будем использовать плагин Lombok, который позволяет сократить время написания кода и количество строк кода за счет автоматической генерации конструкторов, геттеров, сеттеров и других полезных аннотаций.

- **JavaFaker**

Мы будем использовать плагин JavaFaker для генерации тестовых данных, таких как имена, пароли и т.д. Это позволит решить проблему хардкодирования тестовых данных в методах.

- **Docker**

Мы будем использовать Docker для развертывания и использования приложений, которые могут представлять определенные риски в процессе автоматизации и требуют определенных навыков. Мы будем использовать Docker для развертывания СУБД MySQL и PostgreSQL, так как заявлено, что сервис покупки туров поддерживает именно эти две СУБД, а также для запуска симуляции сервисов банка, написанных с помощью Node.js.

- **Allure**

Для просмотра расширенного отчета о прохождении тестов мы будем использовать Allure, так как в нем предусмотрен значительно больший функционал по сравнению со стандартным отчетом Gradle.

## 3. Перечень и описание возможных рисков при автоматизации

- Технические трудности при настройке Docker-compose.yml и системы под тестирование (SUT), такие как проблемы с запуском базы данных или неполадки при запуске SUT;
- Сложности в работе с несколькими базами данных MySQL и PostgreSQL, которые используются для подключения к тестам;
- Некорректная генерация тестовых данных с помощью JavaFaker может привести к ложным срабатываниям тестов;
- Изменения в дизайне или содержимом сайта могут привести к тому, что тесты перестанут работать, например, если тесты привязаны к конкретному тексту на сайте, а этот текст будет изменен.

- Сложности с поиском и привязкой к необходимым CSS-селекторам для Selenide.

## 4. Интервальная оценка с учётом рисков (в часах)

- Подготовка к проведению тестирования — 2 часа;
- Написание кода + рефакторинг — 50 часов;
- Резерв времени на написание баг-репортов — 6 часов;
- Подготовка отчета о результатах прогона тестов — 4 часов;
- Подготовка комплексного отчета по всему процессу автоматизации тестирования — 8 часов;

## 5. План сдачи работ

- Автоматизация тестов будет завершена через 6 рабочих дней после утверждения плана;
- Отчеты по результатам прогона тестов будут подготовлены через 2 рабочих дня после прогона;
- Комплексный отчет по автоматизации будет подготовлен через 2 рабочих дня после подготовки отчетов о прогоне и написания баг-репортов.
